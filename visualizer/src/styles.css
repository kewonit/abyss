/* ── Tailwind must come FIRST — @import before any other at-rules ─ */
@import "tailwindcss";

/* ── Self-hosted Inter font (no CDN dependency) ───────────────── */
@font-face {
  font-family: "Inter";
  font-style: normal;
  font-weight: 100 900;
  font-display: swap;
  src: url("/fonts/inter-latin-ext.woff2") format("woff2");
  unicode-range:
    U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304,
    U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB,
    U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: "Inter";
  font-style: normal;
  font-weight: 100 900;
  font-display: swap;
  src: url("/fonts/inter-latin.woff2") format("woff2");
  unicode-range:
    U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC,
    U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212,
    U+2215, U+FEFF, U+FFFD;
}

/* ── a11y & base overrides — inside @layer base so Tailwind utilities
     can still override them (unlayered CSS beats ALL layers) ──── */
@layer base {
  /* Skip navigation */
  .skip-nav {
    position: absolute;
    top: -100%;
    left: 16px;
    z-index: 9999;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
    color: var(--page-fg);
    background: var(--page-bg);
    border: 2px solid var(--accent-cyan);
    border-radius: 8px;
    text-decoration: none;
    transition: top 0.15s ease;
  }
  .skip-nav:focus {
    top: 8px;
  }

  /* Global focus-visible ring (a11y) */
  :focus-visible {
    outline: 2px solid var(--accent-cyan);
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* Remove outline from mouse clicks — only show for keyboard nav */
  :focus:not(:focus-visible) {
    outline: none;
  }

  /* Reduced motion support (a11y) */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}

:root {
  --ui-fg: 240, 240, 245;
  --ui-bg: 18, 18, 24;
  --accent-cyan: #00d4f5;
  --accent-orange: #ff7a45;
  --accent-purple: #b06cff;
  --accent-green: #2dd4a8;
  --accent-amber: #ffb020;
  --accent-red: #ff4d6a;
  --font-sans:
    "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    "Helvetica Neue", Arial, sans-serif;
  --font-mono:
    "SF Mono", ui-monospace, "JetBrains Mono", "Cascadia Code", "Fira Code",
    Consolas, monospace;
  --pill-bg: rgba(var(--ui-bg), 0.65);
  --pill-border: rgba(var(--ui-fg), 0.06);
  --pill-radius: 14px;
  --page-bg: #101016;
  --page-fg: #e8e8ed;
}

body.light-mode {
  --ui-fg: 30, 30, 35;
  --ui-bg: 255, 255, 255;
  --pill-bg: rgba(var(--ui-bg), 0.75);
  --pill-border: rgba(var(--ui-fg), 0.1);
  --page-bg: #f0f2f5;
  --page-fg: #1a1a1a;
}

/* Light mode dialog overrides */
body.light-mode [data-radix-dialog-content] {
  background: rgba(255, 255, 255, 0.92) !important;
  border-color: rgba(0, 0, 0, 0.08) !important;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15) !important;
}

body.light-mode [data-radix-dialog-content] h2 {
  color: #1a1a1a !important;
}

body.light-mode [data-radix-dialog-content] button {
  color: rgba(0, 0, 0, 0.5);
}

body.light-mode [data-radix-dialog-content] button:hover {
  background: rgba(0, 0, 0, 0.05);
  color: rgba(0, 0, 0, 0.8);
}

/* Light mode switch */
body.light-mode [data-state="unchecked"][role="switch"] {
  background: rgba(0, 0, 0, 0.15) !important;
}

body.light-mode [role="switch"] span {
  background: #fff !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
}

/* Light mode accents — shadows for glassmorphism elements */
body.light-mode aside {
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

/* Light mode Radix overlay components */
body.light-mode [data-radix-popper-content-wrapper] [role="listbox"],
body.light-mode [data-radix-select-content],
body.light-mode [data-radix-alert-dialog-content] {
  background: rgba(255, 255, 255, 0.95) !important;
  border-color: rgba(0, 0, 0, 0.08) !important;
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12) !important;
}

body.light-mode [role="tooltip"] {
  background: rgba(255, 255, 255, 0.92) !important;
  border-color: rgba(0, 0, 0, 0.08) !important;
  color: #1a1a1a !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
}

/* Light mode map controls — don't invert icons */
body.light-mode .maplibregl-ctrl-group {
  background: rgba(255, 255, 255, 0.85) !important;
  border-color: rgba(0, 0, 0, 0.1) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
}
body.light-mode .maplibregl-ctrl-group button .maplibregl-ctrl-icon {
  filter: brightness(0.4);
}
body.light-mode .maplibregl-ctrl-group button:hover {
  background: rgba(0, 0, 0, 0.04) !important;
}
body.light-mode .maplibregl-ctrl-group button:hover .maplibregl-ctrl-icon {
  filter: brightness(0);
}

/* Light mode vignette — softer */
body.light-mode
  .after\:bg-\[radial-gradient\(ellipse_at_center\,transparent_50\%\,rgba\(0\,0\,0\,0\.45\)_100\%\)\]::after {
  background: radial-gradient(
    ellipse at center,
    transparent 60%,
    rgba(0, 0, 0, 0.08) 100%
  ) !important;
}

/* ── Base layout & typography ──────────────────────────────────── */
@layer base {
  html {
    font-size: 16px; /* keep 1rem = 16px so Tailwind defaults work */
  }

  body,
  #root {
    width: 100%;
    height: 100dvh;
    overflow: hidden;
    background: var(--page-bg);
    color: var(--page-fg);
    font-family: var(--font-sans);
    font-size: 14px;
    -webkit-font-smoothing: antialiased;
    transition:
      background 0.3s ease,
      color 0.3s ease;
  }

  /* Firefox / cross-browser scrollbar */
  * {
    scrollbar-width: thin;
    scrollbar-color: rgba(var(--ui-fg), 0.08) transparent;
  }
  *:hover {
    scrollbar-color: rgba(var(--ui-fg), 0.14) transparent;
  }

  /* Selection */
  ::selection {
    background: rgba(0, 212, 245, 0.25);
    color: inherit;
  }

  html {
    overscroll-behavior: contain;
    scrollbar-gutter: stable;
  }
}

@keyframes pulse-dot {
  0%,
  100% {
    box-shadow: 0 0 4px rgba(45, 212, 168, 0.4);
  }
  50% {
    box-shadow: 0 0 10px rgba(45, 212, 168, 0.7);
  }
}

/* ── View transition fade-in ──────────────────────────────────── */
@keyframes view-fade-in {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.view-enter {
  animation: view-fade-in 0.2s ease-out both;
}

/* ── Card hover micro-interaction ─────────────────────────────── */
.card-hover {
  transition:
    transform 0.2s cubic-bezier(0.23, 1, 0.32, 1),
    box-shadow 0.2s cubic-bezier(0.23, 1, 0.32, 1),
    border-color 0.2s ease;
}
.card-hover:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.15);
}

/* ── Recording pulse border ───────────────────────────────────── */
@keyframes rec-pulse {
  0%,
  100% {
    border-color: rgba(255, 77, 106, 0.2);
  }
  50% {
    border-color: rgba(255, 77, 106, 0.45);
  }
}
.recording-pulse {
  animation: rec-pulse 2s ease-in-out infinite;
}

/* ── Map loading shimmer ──────────────────────────────────────── */
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(400%);
  }
}

/* ── Chart draw-in reveal ─────────────────────────────────────── */
@keyframes chart-reveal {
  from {
    clip-path: inset(0 100% 0 0);
  }
  to {
    clip-path: inset(0 0 0 0);
  }
}

.chart-draw-in > :last-child {
  animation: chart-reveal 0.8s cubic-bezier(0.22, 1, 0.36, 1) both;
}

@media (prefers-reduced-motion: reduce) {
  .chart-draw-in > :last-child {
    animation: none;
  }
}

/* ── Tab content fade ─────────────────────────────────────────── */
@keyframes tab-fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
.tab-content-enter {
  animation: tab-fade-in 0.15s ease-out both;
}

/* ── Scrub bar thumb ──────────────────────────────────────────── */
input[type="range"][aria-label="Playback position"] {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
}
input[type="range"][aria-label="Playback position"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--accent-cyan);
  box-shadow: 0 0 4px rgba(0, 212, 245, 0.4);
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.15s ease;
}
input[type="range"][aria-label="Playback position"]:hover::-webkit-slider-thumb,
input[type="range"][aria-label="Playback position"]:active::-webkit-slider-thumb {
  opacity: 1;
}
input[type="range"][aria-label="Playback position"]::-moz-range-thumb {
  width: 12px;
  height: 12px;
  border: none;
  border-radius: 50%;
  background: var(--accent-cyan);
  box-shadow: 0 0 4px rgba(0, 212, 245, 0.4);
  cursor: pointer;
}

/* == MapLibre overrides =========================================== */

.maplibregl-ctrl-attrib {
  display: none !important;
}
.maplibregl-ctrl-logo {
  display: none !important;
}

.maplibregl-ctrl-group {
  background: var(--pill-bg) !important;
  border: 1px solid var(--pill-border) !important;
  border-radius: var(--pill-radius) !important;
  backdrop-filter: blur(24px);
  box-shadow: none !important;
}

.maplibregl-ctrl-group button {
  width: 32px !important;
  height: 32px !important;
  border: none !important;
  border-bottom: 1px solid rgba(var(--ui-fg), 0.04) !important;
}

.maplibregl-ctrl-group button:last-child {
  border-bottom: none !important;
}

.maplibregl-ctrl-group button .maplibregl-ctrl-icon {
  filter: invert(1) brightness(0.6);
}

.maplibregl-ctrl-group button:hover .maplibregl-ctrl-icon {
  filter: invert(1) brightness(1);
}

/* == uPlot overrides ============================================= */

.uplot-wrapper .uplot {
  font-family: var(--font-sans) !important;
}

.uplot-wrapper .u-legend {
  font-size: 10px !important;
  padding: 4px 0 0 !important;
  text-align: left !important;
}

.uplot-wrapper .u-legend .u-series {
  display: inline-flex !important;
  align-items: center !important;
  gap: 4px;
  padding: 2px 8px 2px 0 !important;
}

.uplot-wrapper .u-legend .u-marker {
  width: 8px !important;
  height: 8px !important;
  border-radius: 2px !important;
}

.uplot-wrapper .u-legend .u-label {
  color: rgba(var(--ui-fg), 0.4) !important;
  font-size: 10px !important;
}

.uplot-wrapper .u-legend .u-value {
  color: rgba(var(--ui-fg), 0.6) !important;
  font-family: var(--font-mono) !important;
  font-size: 10px !important;
}

.uplot-wrapper .u-select {
  background: rgba(var(--ui-fg), 0.05) !important;
}

.uplot-wrapper .u-cursor-x,
.uplot-wrapper .u-cursor-y {
  border-color: rgba(var(--ui-fg), 0.12) !important;
}
